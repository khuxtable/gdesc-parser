info
    name: "Sample Game",
    version: "3.0",
    author: "Kathryn Huxtable",
    date: "20 June 1982";

include "verbs.gdesc";

noise "and";

verb "east" "easterly";

flags variable
    moved;          // Optional STATUS variable flag, maintained by the kernel

flags place
    been.here;      // place flag, maintained by the kernel

flags object
    seen, not.seen,           // object flag, maintained by the kernel
    is.lit;

state
    lit.up = 15;

include "objects.gdesc";

include "places.gdesc";

include "actions.gdesc";

object Coke
    "coke can"
    "There is a can of coke here.";

place ninth_mississippi
    "You are standing at the corner of 9th and Mississippi."
    """
    You are standing at the corner of 9th and Mississippi.
    To the north are singed trees and devastated buildings.
    Southward, KU can be seen, a tattered flag waving over Fraser Hall.
    To the east are the remains of downtown Lawrence."""
    {
    	move("south", stadium);
    	move("east", joes);
    	move("easterly", joes);
    	if (lit.up) {
    	    say("It's bright");
    	}
    }

action "describe" {
    describe(arg2);
    break repeat;
}

initial {
    apport(coke, In_Joes);
    apport(sandwich, In_Joes);
}
initial {
    goto(Ninth_Mississippi);
}
/*
repeat {,
    if (flag(status, moved)) {   // Has the player moved?
        call (describeHere);  // If so, describe their new location
    }
}
*/
repeat {
    if (isflag(status, moved)) {
        describe(here);
        bail.out(foo);
        var youSee = true;
        for (var optr : here) {
            if (youSee) {
                var youSee;
                say("");
                youSee = false;
                say(youSee);
            }
            if (been.here) {
                describe(optr);
                x="aoeu";
            }
        }
        youSee = false;
        say(cannot_tell_directions);
    }
    input();                    // Get and parse player's command
    //say("arg1 is $", arg1);
    //say("arg2 is $", arg2);
    //say("status is $", status);
    if (status < 0) { // Can't find 2nd or 1st command word in the vocabulary
        quip ("Pardon?");       // Command parse failure -- abort the main loop
    }
}
repeat {
    if (key(quit)) {    // If the word QUIT occurs in the command
               say ("As you wish.");
        stop();         // Exit the game
}
    here();             // Execute code, if any, associated with this location
    //respond(down, up, out, "There is no such exit here.");
    arg1();           // Handle player's command
    if (not.seen) {
        say ("foo");
    }
    bail.out();     // Command not handled - report an error
}

proc bail.out stuff nonsense {
    var qualifier;                  // Local variable initialised to zero
    if (status == 1) {
        LOOP:
        for (var loop = 0; loop < 3; loop++) {
            say(you_do, loop);
            continue LOOP;
        }
        say(stuff, nonsense);
        if (arg1 instanceof verb) {  // If that word is an object name
            if (!isnear(arg1)) {
                quip("There is no # here!", arg1);
            } else if (foo()) {
                waste();
            } else {
                quip("You need to say what you want to do with the #.", arg1);
            }
        } else {
            quip("You need to say what you want to #.", arg1);
        }
    }
    quip("You can't do that!");     // Generic no can do
}

fragment you_do
    "You #";
text cannot_tell_directions
    """
    You can't tell directions here.
    Try Up, Down, Left, Right, Forward, Back
    """;
text what_is_x
    "What is '#'?";
